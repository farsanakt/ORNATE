<%- include('../layouts/header') %>


	<div class="page-wrapper">
		

		<%- include('../layouts/navbar-2.ejs') %>



			<main class="main">
				<div class="page-header text-center" style="background-image: url('assets/images/zerac/aboutpage.jpg')">
					<div class="container">
						<h1 class="page-title text-white ">All Products<span>Shop</span></h1>
					</div><!-- End .container -->
				</div><!-- End .page-header -->

				<nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
					<div class="container">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="index.html">Home</a></li>
							<!-- <li class="breadcrumb-item"><a href="#">Shop</a></li> -->
							<li class="breadcrumb-item active" aria-current="page">All Products</li>
						</ol>
					</div>

					<div class="search-container">
						<div class="row">
							<div class="header-search-wrapper" style="margin-left: 450px;">
								<label for="q" class="sr-only">Search</label>
								<input style="width: 700px;" type="text" class="form-control" name="q" id="search" placeholder="Search in...">
							</div>
							<a href="#" class="search-toggle" style="font-size: 30px;" role="button" title="Search"><i class="icon-search"></i></a>
						</div>
					</div>
				

					
					
					<div class="toolbox-right">
							
						<div class="toolbox-sort">
							<label for="sortby">Sort by: price</label>
							<div class="select-custom">
								<select name="sortby" id="sortby" class="form-control">
									<option value="priceLow-High" id="priceLow-High" <% if (sortQuery==='priceLow-High' ) { %>selected<% } %>>Low-High</option>
									<option value="priceHigh-Low" id="priceHigh-Low" <% if (sortQuery==='priceHigh-Low' ) { %>selected<% } %>>High-Low</option>
									<option value="nameA-Z" id="nameA-Z" <% if (sortQuery==='nameA-Z' ) { %>selected<% } %>>A - Z</option>
									<option value="nameZ-A" id="nameZ-A" <% if (sortQuery==='nameZ-A' ) { %>selected<% } %>>Z - A</option>
									<option value="newArrivals" id="newArrivals" <% if (sortQuery==='newArrivals' ) { %>selected<% } %>>New Arrivals</option>

								</select>
							</div>
						</div><!-- End .toolbox-sort -->
						<!-- End .toolbox-layout -->
					</div><!-- End .container -->
				</nav><!-- End .breadcrumb-nav -->

				<div class="page-content">
					<div class="container">
						<div class="row">
							<div class="col-lg-9">


								<div class="products mb-3">
									<div class="row justify-content-center " id="productList">


										<% for (let i=0; i < products.length; i++) { %>




											<div class="col-6 col-md-4 col-lg-4">
												<div class="product product-7 text-center">
													<figure class="product-media">
														<% offerData.forEach(offr =>{ %>
														<%	if (products[i].category===offr.category.name)  { %>
																<span style="background-color: rgb(194, 55, 55);" class="product-label label-new"><%= offr.offer  %>%</span>
															
														<%}else {%>
															<span class="product-label label-new">New</span>
												<%	}}) %>
														<a href="/productdetails?id=<%= products[i]._id %>">
															<img src="<%= products[i].images[0] %>"
																alt="Product image xxxxxxx" class="product-image">
														</a>

														<div class="product-action-vertical">

															<a onclick="addWishlist('<%= products[i]._id %>')"
																class="btn-product-icon btn-wishlist btn-expandable"><span>add
																	to wishlist</span></a>
															
														</div><!-- End .product-action-vertical -->

														<div class="product-action">
															<% if (products[i].stock === 0) { %>
																<a class="btn-product btn-cart disabled" style="pointer-events: none; opacity: 0.90;"><span>Out of Stock</span></a>
															<% } else { %>
																<a onclick="addCart('<%= products[i]._id %>')" class="btn-product btn-cart"><span>add to cart</span></a>
															<% } %>
														</div>
														<!-- End .product-action -->

													</figure><!-- End .product-media -->

													<div class="product-body">
														<div class="product-cat">
															<a href="#">
																<%= products[i].category %>
															</a>
														</div><!-- End .product-cat -->
														<h3 class="product-title"><a href="product.html">
																<%= products[i].name %>
															</a></h3><!-- End .product-title -->
														<% if(products[i].offerPrice==null) {%>
															<div class="product-price">
															<%= products[i].price %>
														</div><% } else { %>
															
																<div style="text-decoration: line-through;" class="product-price">
																	<%= products[i].price %>
																</div>
															<div class="product-price">
																<%=  products[i].offerPrice%>
															</div>
														
													<%	} %>
														<!-- End .product-price -->
													<!--	<div class="ratings-container">
															<div class="ratings">
																<div class="ratings-val" style="width: 20%;"></div>
																 End .ratings-val 
															</div> End .ratings 
															<span class="ratings-text">( 2 Reviews )</span>
														</div> End .rating-container -->

													

													</div><!-- End .product-body -->
												</div><!-- End .product -->
											</div><!-- End .col-sm-6 col-lg-4 -->
											<% } %>

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

												<div class="col-6 col-md-4 col-lg-4">

												</div><!-- End .col-sm-6 col-lg-4 -->

									</div><!-- End .row -->
								</div><!-- End .products -->

								<nav aria-label="Page navigation">
									<ul class="pagination justify-content-center">
										<% if (currentPage > 1) { %>
											<li class="page-item"><a class="page-link" href="?page=<%= currentPage - 1 %>&search<%= search %>&category=<%= selectCategories.join(',') %>&sortBy=<%= sortQuery %>">&laquo; Previous</a></li>
										<% } %>
										<% for (let i = 1; i <= totalPages; i++) { %>
											<li class="page-item <%= currentPage == i? 'active' : '' %>"><a class="page-link" href="?page=<%= i %>&search<%= search %>&category=<%= selectCategories.join(',') %>&sortBy=<%= sortQuery %>"><%= i %></a></li>
										<% } %>
										<% if (currentPage < totalPages) { %>
											<li class="page-item"><a class="page-link" href="?page=<%= currentPage + 1 %>&search<%= search %>&category=<%= selectCategories.join(',') %>&sortBy=<%= sortQuery %>">Next &raquo;</a></li>
										<% } %>
									</ul>
								</nav>
							</div><!-- End .col-lg-9 -->
							<aside class="col-lg-3 order-lg-first">
								<div class="sidebar sidebar-shop">
									<div class="widget widget-clean">
										<label>Filters:</label>
										<a href="#" id="clear" onclick="clearFilter()" class="sidebar-filter-clear">Clean All</a>
									</div><!-- End .widget widget-clean -->

									<div class="widget widget-collapsible">
										<h3 class="widget-title">
											<a data-toggle="collapse" href="#widget-1" role="button"
												aria-expanded="true" aria-controls="widget-1">
												Category
											</a>
										</h3><!-- End .widget-title -->
										<div class="collapse show" id="widget-1">
											<div class="widget-body">
												<div class="filter-items filter-items-count">
													<% categoryData.forEach(category => { %>
														<% if (category.is_Listed) { %>
															<div class="filter-item">
																<div class="custom-control custom-checkbox">
																	<input type="checkbox" name="category" class="custom-control-input" value="<%= category.name %>"  id="<%= category._id %>" name="<%= category.name %>" 
																	<%
																	if(selectCategories.includes(String(category.name))) { %> checked
																	<% } %>
																	>
																	<label class="custom-control-label" for="<%= category._id %>"><%= category.name %></label>
																</div>
																<span class="item-count"></span>
															</div>
														<% } %>
													<% }); %>
												</div><!-- End .filter-items -->
											</div><!-- End .widget-body -->
										</div><!-- End .collapse -->
										<div style="margin-top: 30px; margin-left: 30px;">
											<button id="apply" class="btn btn-success">Apply</button>
										</div>
										
												
											</div><!-- End .widget-body -->
										</div><!-- End .collapse -->
										
										
									</div><!-- End .widget -->
									
								</div><!-- End .sidebar sidebar-shop -->
							</aside><!-- End .col-lg-3 -->
						</div><!-- End .row -->
					</div><!-- End .container -->
				</div><!-- End .page-content -->
			</main><!-- End .main -->



			<!-- Connect Footer -->
			<%- include('../layouts/footbar-2') %>
				<!-- Connect Footer -->

	</div>

	<button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

	<!--Connect Mobaile View-->

	<!--Connect Mobaile View-->

	<!-- Plugins JS File -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/bootstrap.bundle.min.js"></script>
	<script src="assets/js/jquery.hoverIntent.min.js"></script>
	<script src="assets/js/jquery.waypoints.min.js"></script>
	<script src="assets/js/superfish.min.js"></script>
	<script src="assets/js/owl.carousel.min.js"></script>
	<!-- Main JS File -->
	<script src="assets/js/main.js"></script>


	<script>

		//  Add Wishlist

		function addWishlist(id) {

			fetch(`/addWishlist?id=${id}`, { method: 'POST' })

				.then(res => res.json())

				.then(data => {

					if (data.suc) {

						const Toast = Swal.mixin({

							toast: true,
							position: "top-end",
							showConfirmButton: false,
							timer: 3000,
							timerProgressBar: true,

							didOpen: (toast) => {

								toast.onmouseenter = Swal.stopTimer;
								toast.onmouseleave = Swal.resumeTimer;
							}

						});

						Toast.fire({

							icon: "warning",
							title: "Already Added"

						});

					} else if (data.succ) {

						const Toast = Swal.mixin({

							toast: true,
							position: "top-end",
							showConfirmButton: false,
							timer: 3000,
							timerProgressBar: true,

							didOpen: (toast) => {
								toast.onmouseenter = Swal.stopTimer;
								toast.onmouseleave = Swal.resumeTimer;
							}

						});

						Toast.fire({

							icon: "success",
							title: "Added TO Wishlist"

						});


					}

				})

		};

	</script>

	<script>

		// Add cart
		function addCart(id) {
			fetch(`/addCart?id=${id}`, { method: 'post' })
				.then(res => {
					if (!res.ok) {
						throw new Error('Network response was not ok');
					}
					return res.json();
				})
				.then(data => {
					if (data.succ) {
						// Show success alert
						Swal.fire({
							icon: 'success',
							title: 'Success!',
							text: 'Added to cart',
							showConfirmButton: false,
							timer: 1500
						});
					} else if (data.fail) {
						// Show error alert
						Swal.fire({
							icon: 'error',
							title: 'Error!',
							text: 'Already existed',
							showConfirmButton: false,
							timer: 1500
						});
					}
				})
				.catch(error => {
					// Show error alert
					Swal.fire({
						icon: 'error',
						title: 'Error!',
						text: 'An error occurred',
						showConfirmButton: false,
						timer: 1500
					});
					console.error('Error:', error);
				});
		}
	</script>


<script>
    const fetchFilteredProducts = async () => {
        try {
            const search = document.getElementById('search').value.trim()
           

             const categoryFilters = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(input => input.value).join(',');
             const sortBy = document.getElementById('sortby').value.trim()
			 console.log(sortBy,'Search value');


            const queryParams = new URLSearchParams({
                search: search,
                category: categoryFilters,
                sortBy: sortBy
            });

             window.location.href = `/product?${queryParams}`;
        } catch (error) {
            console.error('Error filtered products:', error);
        }
    };

    document.getElementById('apply').addEventListener('click', fetchFilteredProducts);
</script>

<script>

let s = window.location.pathname;
let queryString = window.location.search;

let clear = document.getElementById('clear');


if (queryString) {
	clear.style.display = 'block'
} else {
	clear.style.display = 'none'
}  
</script>


<script>

function clearFilter() {
	window.location.href = '/product'
}
</script>



<script src="https://cdn.jsdelivr.net/npm/sweetalert@2"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/6en8XCp+HHAAK5GSLf2xlYtvJ8U2Q4U+9cuEnJoa3" crossorigin="anonymous">


	<%- include('../layouts/footer') %>